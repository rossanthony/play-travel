"use strict";var console=console||{};angular.module("PlayTravelApp",["ui.router","ngAnimate","ngResource","ngMessages","ngSanitize","ngCookies","ui.bootstrap","ui.select","angular-loading-bar","toastr","satellizer","mgcrea.ngStrap","ngMaterial","md.data.table","PlayTravelApp.controllers","PlayTravelApp.services","PlayTravelApp.tpls","PlayTravelApp.admin-flights","PlayTravelApp.ui-search"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$authProvider","$alertProvider",function(e,t,a,l,n){t.otherwise("/404"),e.state("admin",{url:"/admin","abstract":!0,templateUrl:"/assets/tpls/admin-layout.html",controller:"AdminCtrl",resolve:{authenticated:["$q","$location","$auth",function(e,t,a){var l=e.defer();return a.isAuthenticated()?l.resolve():t.path("/signIn"),l.promise}],UiData:["UiData",function(e){return e()}]}}).state("signUp",{url:"/signUp",templateUrl:"/views/signUp.html",controller:["$scope","$alert","$auth",function(e,t,a){e.submit=function(l){l.preventDefault(),a.signup({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password}).then(function(){t({content:"You have successfully signed up",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(e){t({content:e.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]}).state("signIn",{url:"/signIn",templateUrl:"/views/signIn.html",controller:"SignInCtrl"}).state("signOut",{url:"/signOut",template:null,controller:"SignOutCtrl"}).state("404",{url:"/404",templateUrl:"/assets/tpls/404.html",controller:"NotFoundCtrl"})}]).config(["$locationProvider",function(e){e.html5Mode(!0)}]).config(["toastrConfig",function(e){angular.extend(e,{allowHtml:!0,positionClass:"toast-bottom-right"})}]).config(["$httpProvider","$authProvider",function(e,t){e.interceptors.push(["$q","$injector",function(e,t){return{request:function(e){var a=t.get("$auth");a.isAuthenticated()&&(e.headers["X-Auth-Token"]=a.getToken());var l=t.get("$cookies"),n=l.get("PLAY_CSRF_TOKEN");return n&&(e.headers["Csrf-Token"]=n),e},responseError:function(a){if(401===a.status){var l=t.get("$auth");l.logout(),t.get("$state").go("signIn")}return e.reject(a)}}}]),t.httpInterceptor=!0,t.loginOnSignup=!0,t.loginRedirect="/admin/flights",t.logoutRedirect="/signIn",t.signupRedirect="/admin",t.loginUrl="/signIn",t.signupUrl="/signUp",t.loginRoute="/signIn",t.signupRoute="/signUp",t.tokenName="token",t.tokenPrefix="satellizer",t.authHeader="X-Auth-Token",t.platform="browser",t.storage="localStorage"}]).run(["$rootScope","$state",function(e,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,l=this.length;l>a;a++)if(this[a]===e)return a;return-1})}]),angular.module("PlayTravelApp.controllers",[]).controller("AdminCtrl",["$rootScope","$scope","$state","$stateParams","$location","UiData","$interval",function(e,t,a,l,n,o,r){t.uiData=o,console.log("UiData",o)}]).controller("NotFoundController",["$scope","$state",function(e,t){console.log("NotFound")}]).controller("SignUpCtrl",["$scope","$alert","$auth",function(e,t,a){e.submit=function(l){l.preventDefault(),a.signup({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password}).then(function(){t({content:"You have successfully signed up",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(e){t({content:e.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]).controller("SignInCtrl",["$scope","$alert","$auth","$state",function(e,t,a,l){e.submit=function(){a.setStorageType(e.rememberMe?"localStorage":"sessionStorage"),a.login({email:e.email,password:e.password,rememberMe:e.rememberMe}).then(function(){console.log("logged in!!"),l.go("admin.flights"),t({content:"You have successfully signed in",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(e){console.log(e),t({content:e.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})},e.authenticate=function(e){a.authenticate(e).then(function(){t({content:"You have successfully signed in",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(e){t({content:e.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]).controller("SignOutCtrl",["$auth","$alert",function(e,t){e.isAuthenticated()&&e.logout().then(function(){t({content:"You have been logged out",animation:"fadeZoomFadeDown",type:"material",duration:3})})}]),angular.module("PlayTravelApp.services",[]).factory("Ui",["$resource",function(e){return e("http://127.0.0.1:9000/user")}]).factory("UiData",["$q","Ui",function(e,t){return function(){var a=e.defer();return t.get(function(e){a.resolve(e)},function(){a.reject("Unable to fetch data")}),a.promise}}]).factory("ReloadState",["$state",function(e){return function(){e.transitionTo(e.current.name,e.params,{reload:e.$current})}}]).factory("DeleteConfirmation",["$uibModal",function(e){return function(t,a){var l=e.open({templateUrl:"template/confirm-delete.html",size:"sm",resolve:{message:function(){return t}},controller:["$scope","$uibModalInstance","message",function(e,t,a){e.message=a,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]});l.result.then(function(){a()},function(){})}}]),angular.module("PlayTravelApp.tpls",["template/confirm-delete.html"]),angular.module("template/confirm-delete.html",[]).run(["$templateCache",function(e){e.put("template/confirm-delete.html",'   <div class="modal-header">       <h5 class="modal-title">{{(message != \'\' ? message : \'Please confirm you wish to delete\' )}}</h5>   </div>   <div class="modal-body">       <div class="text-right">           <div class="btn-group" role="group" aria-label="...">               <button type="button" ng-click="ok()" class="btn btn-sm btn-default"><span class="fa fa-paper-plane-o"></span> Proceed</button>               <span class="btn btn-default btn-sm" ng-click="cancel()"><span class="fa fa-close"></span>&nbsp;&nbsp;Close (Esc)</span>           </div>       </div>   </div>')}]),angular.module("PlayTravelApp.admin-flights",["PlayTravelApp.admin-flights.controllers","PlayTravelApp.admin-flights.services","PlayTravelApp.admin-flights.tpls"]).config(["$stateProvider",function(e){e.state("admin.flights",{url:"/flights?{items_per_page}&{page}",templateUrl:"/assets/tpls/admin/flights.html",controller:"FlightsPageCtrl"}).state("admin.flights.item",{url:"/:flight",templateUrl:"/assets/tpls/admin/flight.html",controller:"FlightPageCtrl"})}]),angular.module("PlayTravelApp.admin-flights.controllers",[]).controller("FlightsPageCtrl",["$scope","$state","$flights","$mdDialog",function(e,t,a,l){function n(t){console.log("query",t),e.promise=a.flights.get(t||e.query,o).$promise}function o(t){e.flights=t.data}var r;e.selected=[],e.options={autoSelect:!0,boundaryLinks:!0,largeEditDialog:!0,pageSelector:!0,rowSelection:!0},e.query={order:"departureLocation",limit:5,page:1},e.onPaginate=function(t,a){n(angular.extend({},e.query,{page:t,limit:a}))},e.onReorder=function(t){n(angular.extend({},e.query,{order:t}))},e.removeFilter=function(){e.filter.show=!1,e.query.filter="",e.filter.form.$dirty&&e.filter.form.$setPristine()},e.$watch("query.filter",function(t,a){a||(r=e.query.page),t!==a&&(e.query.page=1),t||(e.query.page=r),n()}),e.addItem=function(e){l.show({clickOutsideToClose:!0,controller:"addFlightController",controllerAs:"ctrl",focusOnOpen:!1,targetEvent:e,templateUrl:"assets/tpls/admin/add-flight-dialog.html"}).then(n)},e["delete"]=function(t){l.show({clickOutsideToClose:!0,controller:"deleteFlightController",controllerAs:"ctrl",focusOnOpen:!1,targetEvent:t,locals:{flights:e.selected},templateUrl:"assets/tpls/admin/delete-flight-dialog.html"}).then(n)}}]).controller("addFlightController",["$scope","$state","$flights","$mdDialog",function(e,t,a,l){function n(e){l.hide(e)}this.cancel=l.cancel,this.addItem=function(){e.item.form.$setSubmitted(),e.item.form.$valid&&a.flights.save({flight:e.flight},n)}}]).controller("deleteFlightController",["$scope","$state","flights","$flights","$mdDialog","$q",function(e,t,a,l,n,o){function r(e,t){var n=l.flights.remove({id:e.id});return n.$promise.then(function(){a.splice(t,1)}),n.$promise}function i(){n.hide()}this.cancel=n.cancel,this.confirm=function(){console.log("flights",a),o.all(a.forEach(r)).then(i)}}]),angular.module("PlayTravelApp.admin-flights.services",[]).factory("$flights",["$resource",function(e){return{flights:e("flight/:id")}}]),angular.module("PlayTravelApp.admin-flights.tpls",["template/reclassify-message-overlay.html"]),angular.module("template/reclassify-message-overlay.html",[]).run(["$templateCache",function(e){e.put("template/reclassify-message-overlay.html",'   <div class="modal-header">       <h4 class="modal-title">Reclassify message</h4>   </div>   <div class="modal-body">       <md-input-container class="md-block">           <label>Original message</label>           <textarea ng-model="text" columns="1" rows="5" ng-disabled="true"></textarea>       </md-input-container>       <md-input-container class="md-block">           <label>Edit message</label>           <textarea ng-model="textCopy" columns="1" rows="5"></textarea>           <span class="label label-warning" ng-show="textError">This is a required field</span>       </md-input-container>       <md-input-container class="md-block">           <label>Should be classified as:</label>           <div ui-select ng-model="newTopic.value">               <div ui-select-match placeholder="Select...">{{$select.selected.label}}</div>               <div ui-select-choices repeat="option in availableTopics">                   <div ng-bind-html="option.label | highlight: $select.search"></div>               </div>           </div>           <span class="label label-warning" ng-show="topicError">This is a required field</span>       </md-input-container>       <div class="text-right">           <div class="btn-group" role="group" aria-label="...">               <button type="button" ng-click="ok()" class="btn btn-sm btn-default" ng-disabled="disabledForm"><span class="fa fa-paper-plane-o" ng-class="{ \'fa-paper-plane-o\': !disabledForm, \'fa-spin fa-spinner\': disabledForm }"></span> Add to classifier</button>               <span class="btn btn-default btn-sm" ng-click="cancel()"><span class="fa fa-close"></span>&nbsp;&nbsp;Close (Esc)</span>           </div>       </div>   </div>')}]),angular.module("PlayTravelApp.ui-search",["PlayTravelApp.ui-search.controllers","PlayTravelApp.ui-search.services","PlayTravelApp.ui-search.tpls"]).config(["$stateProvider",function(e){e.state("search",{url:"/search?{items_per_page}&{page}",templateUrl:"/assets/tpls/ui/search.html",controller:"SearchPageCtrl",resolve:{SearchData:["SearchData","$stateParams",function(e,t){return e(t)}]}})}]),angular.module("PlayTravelApp.ui-search.controllers",[]).controller("SearchPageCtrl",["$scope","$state","Search",function(e,t,a){e.submit=function(){console.log("form submitted!"),a.get({date_from:123,date_to:321},function(e){console.log(e)},function(e){console.log("Unable to perform search",e)})},e.$watch("pagination.page",function(e,a){if("undefined"!=typeof e&&e!=a){var l=t.params;e>1?l.page=e:l.page=null,t.transitionTo(t.current.name,l,{reload:t.$current})}}),e.changeNumberOfItems=function(e){var a=t.params;a.page=null,20!=e?a.items_per_page=e:a.items_per_page=null,t.transitionTo(t.current.name,a,{reload:t.$current})},console.log("Search controller 1")}]),angular.module("PlayTravelApp.ui-search.services",[]).factory("Search",["$resource",function(e){return e("http://127.0.0.1:9000/search",{get:{method:"GET"},post:{method:"POST",isArray:!1}})}]).factory("SearchData",["$q","Search",function(e,t){return function(a){var l=e.defer();return t.get({page:a.page?a.page:null,items_per_page:a.items_per_page?a.items_per_page:null},function(e){l.resolve(e)},function(){l.reject("Unable to fetch data")}),l.promise}}]),angular.module("PlayTravelApp.ui-search.tpls",["template/reclassify-message-overlay.html"]),angular.module("template/reclassify-message-overlay.html",[]).run(["$templateCache",function(e){e.put("template/reclassify-message-overlay.html",'   <div class="modal-header">       <h4 class="modal-title">Reclassify message</h4>   </div>   <div class="modal-body">       <md-input-container class="md-block">           <label>Original message</label>           <textarea ng-model="text" columns="1" rows="5" ng-disabled="true"></textarea>       </md-input-container>       <md-input-container class="md-block">           <label>Edit message</label>           <textarea ng-model="textCopy" columns="1" rows="5"></textarea>           <span class="label label-warning" ng-show="textError">This is a required field</span>       </md-input-container>       <md-input-container class="md-block">           <label>Should be classified as:</label>           <div ui-select ng-model="newTopic.value">               <div ui-select-match placeholder="Select...">{{$select.selected.label}}</div>               <div ui-select-choices repeat="option in availableTopics">                   <div ng-bind-html="option.label | highlight: $select.search"></div>               </div>           </div>           <span class="label label-warning" ng-show="topicError">This is a required field</span>       </md-input-container>       <div class="text-right">           <div class="btn-group" role="group" aria-label="...">               <button type="button" ng-click="ok()" class="btn btn-sm btn-default" ng-disabled="disabledForm"><span class="fa fa-paper-plane-o" ng-class="{ \'fa-paper-plane-o\': !disabledForm, \'fa-spin fa-spinner\': disabledForm }"></span> Add to classifier</button>               <span class="btn btn-default btn-sm" ng-click="cancel()"><span class="fa fa-close"></span>&nbsp;&nbsp;Close (Esc)</span>           </div>       </div>   </div>')}]);