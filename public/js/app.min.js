"use strict";var console=console||{};angular.module("PlayTravelApp",["ui.router","ngAnimate","ngResource","ngMessages","ngSanitize","ngCookies","ui.bootstrap","ui.select","angular-loading-bar","toastr","satellizer","mgcrea.ngStrap","ngMaterial","md.data.table","PlayTravelApp.controllers","PlayTravelApp.services","PlayTravelApp.admin-flights","PlayTravelApp.ui-search","PlayTravelApp.auth"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$authProvider","$alertProvider",function(t,e,a,o,r){e.when("","/search").when("/","/search").when("/search/","/search").when("/admin","/admin/flights").when("/admin/","/admin/flights").otherwise(function(t,e){var a=t.get("$state");return a.go("404.not-found"),e.path()}),t.state("ui",{url:"","abstract":!0,templateUrl:"/assets/tpls/ui-layout.html",controller:"UiCtrl"}).state("auth",{url:"/auth","abstract":!0,templateUrl:"/assets/tpls/ui-layout.html",controller:"AuthCtrl"}).state("admin",{url:"/admin","abstract":!0,templateUrl:"/assets/tpls/admin-layout.html",controller:"AdminCtrl",resolve:{authenticated:["$q","$location","$auth",function(t,e,a){var o=t.defer();return a.isAuthenticated()?o.resolve():e.path("/signIn"),o.promise}],UiData:["UiData",function(t){return t()}]}}).state("404",{"abstract":!0,templateUrl:"/assets/tpls/ui-layout.html"}).state("404.not-found",{templateUrl:"/assets/tpls/404.html"})}]).config(["$locationProvider",function(t){t.html5Mode(!0)}]).config(["toastrConfig",function(t){angular.extend(t,{allowHtml:!0,positionClass:"toast-bottom-right"})}]).config(["$httpProvider","$authProvider",function(t,e){t.interceptors.push(["$q","$injector",function(t,e){return{request:function(t){var a=e.get("$auth");a.isAuthenticated()&&(t.headers["X-Auth-Token"]=a.getToken());var o=e.get("$cookies"),r=o.get("PLAY_CSRF_TOKEN");return r&&(t.headers["Csrf-Token"]=r),t},responseError:function(a){if(404===a.status&&e.get("$state").go("404.not-found"),401===a.status){var o=e.get("$auth");o.logout(),e.get("$state").go("auth.signIn")}return t.reject(a)}}}]),e.httpInterceptor=!0,e.loginOnSignup=!0,e.loginRedirect="/admin/flights",e.logoutRedirect="/auth/sign-in",e.signupRedirect="/user/account",e.loginUrl="/api/auth/sign-in",e.signupUrl="/api/auth/sign-up",e.loginRoute="/auth/sign-in",e.signupRoute="/auth/sign-up",e.tokenName="token",e.tokenPrefix="satellizer",e.authHeader="X-Auth-Token",e.platform="browser",e.storage="localStorage"}]),angular.module("PlayTravelApp.controllers",[]).controller("UiCtrl",["$rootScope","$scope","$state","$stateParams","$location","UiData",function(t,e,a,o,r,n){e.uiData=n,console.log("user",e.uiData)}]).controller("AdminCtrl",["$rootScope","$scope","$state","$stateParams","$location","$auth","UiData",function(t,e,a,o,r,n,l){e.uiData=l,console.log("user",e.uiData)}]).controller("AuthCtrl",["$rootScope","$scope","$state","$stateParams","$location",function(t,e,a,o,r){}]).controller("NotFoundController",["$scope","$state",function(t,e){console.log("NotFound")}]),angular.module("PlayTravelApp.services",[]).factory("Ui",["$resource",function(t){return t("/api/auth/user")}]).factory("UiData",["$q","Ui",function(t,e){return function(){var a=t.defer();return e.get(function(t){a.resolve(t)},function(){a.reject("Unable to fetch data")}),a.promise}}]).factory("ReloadState",["$state",function(t){return function(){t.transitionTo(t.current.name,t.params,{reload:t.$current})}}]),angular.module("PlayTravelApp.ui-search",["PlayTravelApp.ui-search.controllers","PlayTravelApp.ui-search.services"]).config(["$stateProvider",function(t){t.state("ui.search",{url:"/search?{items_per_page}&{page}",templateUrl:"/assets/tpls/ui/search.html",controller:"SearchPageCtrl",resolve:{SearchData:["SearchData","$stateParams",function(t,e){return t(e)}]}})}]),angular.module("PlayTravelApp.ui-search.controllers",[]).controller("SearchPageCtrl",["$scope","$state","Search",function(t,e,a){console.log("SearchPageCtrl")}]),angular.module("PlayTravelApp.ui-search.services",[]).factory("Search",["$resource",function(t){return t("http://127.0.0.1:9000/search",{get:{method:"GET"},post:{method:"POST",isArray:!1}})}]).factory("SearchData",["$q","Search",function(t,e){return function(a){var o=t.defer();return e.get({page:a.page?a.page:null,items_per_page:a.items_per_page?a.items_per_page:null},function(t){o.resolve(t)},function(){o.reject("Unable to fetch data")}),o.promise}}]),angular.module("PlayTravelApp.admin-flights",["PlayTravelApp.admin-flights.controllers","PlayTravelApp.admin-flights.services"]).config(["$stateProvider",function(t){t.state("admin.flights",{url:"/flights?{items_per_page}&{page}",templateUrl:"/assets/tpls/admin/flights.html",controller:"FlightsPageCtrl"}).state("admin.flights.item",{url:"/:flight",templateUrl:"/assets/tpls/admin/flight.html",controller:"FlightPageCtrl"})}]),angular.module("PlayTravelApp.admin-flights.controllers",[]).controller("FlightsPageCtrl",["$scope","$state","$flights","$mdDialog",function(t,e,a,o){function r(e){console.log("query",e),t.promise=a.flights.get(e||t.query,n).$promise}function n(e){t.flights=e.data}var l;t.selected=[],t.options={autoSelect:!0,boundaryLinks:!0,largeEditDialog:!0,pageSelector:!0,rowSelection:!0},t.filter={options:{debounce:500}},t.query={order:"departureLocation",limit:5,page:1,filter:""},t.onPaginate=function(e,a){r(angular.extend({},t.query,{page:e,limit:a}))},t.onReorder=function(e){r(angular.extend({},t.query,{order:e}))},t.removeFilter=function(){t.filter.show=!1,t.query.filter="",t.filter.form.$dirty&&t.filter.form.$setPristine()},t.$watch("query.filter",function(e,a){a||(l=t.query.page),e!==a&&(t.query.page=1),e||(t.query.page=l),r()}),t.addItem=function(t){o.show({clickOutsideToClose:!0,controller:"addFlightController",controllerAs:"ctrl",focusOnOpen:!1,targetEvent:t,templateUrl:"assets/tpls/admin/add-flight-dialog.html"}).then(r)},t["delete"]=function(e){o.show({clickOutsideToClose:!0,controller:"deleteFlightController",controllerAs:"ctrl",focusOnOpen:!1,targetEvent:e,locals:{flights:t.selected},templateUrl:"assets/tpls/admin/delete-flight-dialog.html"}).then(r)}}]).controller("addFlightController",["$scope","$state","$flights","$mdDialog",function(t,e,a,o){function r(t){o.hide(t)}this.cancel=o.cancel,this.addItem=function(){t.item.form.$setSubmitted(),t.item.form.$valid&&a.flights.save({flight:t.flight},r)}}]).controller("deleteFlightController",["$scope","$state","flights","$flights","$mdDialog","$q",function(t,e,a,o,r,n){function l(t,e){var r=o.flights.remove({id:t.id});return r.$promise.then(function(){a.splice(e,1)}),r.$promise}function i(){r.hide()}this.cancel=r.cancel,this.confirm=function(){console.log("flights",a),n.all(a.forEach(l)).then(i)}}]),angular.module("PlayTravelApp.admin-flights.services",[]).factory("$flights",["$resource",function(t){return{flights:t("flight/:id")}}]),angular.module("PlayTravelApp.auth",["PlayTravelApp.auth.controllers"]).config(["$stateProvider",function(t){t.state("auth.signIn",{url:"/sign-in",controller:"SignInCtrl",templateUrl:"/views/signIn.html"}).state("auth.signUp",{url:"/sign-up",controller:"SignUpCtrl",templateUrl:"/views/signUp.html"}).state("auth.signOut",{url:"/sign-out",controller:"SignOutCtrl",templateUrl:null})}]),angular.module("PlayTravelApp.auth.controllers",[]).controller("SignUpCtrl",["$scope","$state","$auth","$alert",function(t,e,a){t.submit=function(o){o.preventDefault(),e.signup({firstName:t.firstName,lastName:t.lastName,email:t.email,password:t.password}).then(function(){a({content:"You have successfully signed up",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(t){a({content:t.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]).controller("SignInCtrl",["$scope","$auth","$alert","$state",function(t,e,a,o){t.submit=function(){e.setStorageType(t.rememberMe?"localStorage":"sessionStorage"),e.login({email:t.email,password:t.password,rememberMe:t.rememberMe}).then(function(){console.log("logged in!!"),o.go("admin.flights"),a({content:"You have successfully signed in",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(t){console.log(t),a({content:t.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})},t.authenticate=function(t){e.authenticate(t).then(function(){a({content:"You have successfully signed in",animation:"fadeZoomFadeDown",type:"material",duration:3})})["catch"](function(t){a({content:t.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]).controller("SignOutCtrl",["$scope","$auth","$alert","$state",function(t,e,a,o){return e.isAuthenticated()?void e.logout().then(function(){a({content:"You have been logged out",animation:"fadeZoomFadeDown",type:"material",duration:3}),o.go("auth.signIn")}):void o.go("auth.signIn")}]);